:hardbreaks:
= installation on docker

== Docker
https://airflow.apache.org/docs/apache-airflow/2.2.4/start/docker.html

메모리 충분한지 확인. 최소 4GB 이상 필요.

[source,shell]
----
$ docker run --rm "debian:buster-slim" bash -c 'numfmt --to iec $(echo $(($(getconf _PHYS_PAGES) * $(getconf PAGE_SIZE))))'
Unable to find image 'debian:buster-slim' locally
buster-slim: Pulling from library/debian
ebcd4e3db076: Pull complete
Digest: sha256:fac2ae50be3f4e0901582e5c0ef00d06b1f599315a2077ab5b8ea7e304ddbee4
Status: Downloaded newer image for debian:buster-slim
7.7G
----
7.7G이니 충분해 보인다.



docker-compose.yaml 파일 받기

[source,shell]
----
curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.2.4/docker-compose.yaml'
----

* airflow-scheduler
* airflow-webserver
* airflow-worker
* airflow-init
* flower
* postgres
* redis

가 정의되어 있음.

로컬에서 airflow 사용할 때 DAG에서 로컬에 띄운 서버에 연결을 하고자 할 수 있다. 그러려면 docker-compose.yaml 에 설정을 추가해야 한다. 예를 들어 리눅스에서는 `services: airflow-worker` 에 `extra_hosts: - "host.docker.internal:host-gateway"` 를 추가한다. 그리고 localhost대신 host.docker.internal을 사용한다. 이 구성은 플랫폼 마다 다르다. 자세한 내용은 https://docs.docker.com/desktop/networking/#use-cases-and-workarounds 문서를 본다.

...
